<!-- This favicon was generated using the following font:

- Font Title: League Spartan
- Font Author: Copyright 2020 The League Spartan Project Authors (https://github.com/theleagueof/league-spartan)
- Font Source: http://fonts.gstatic.com/s/leaguespartan/v11/kJEnBuEW6A0lliaV_m88ja5Twtx8BWhtkDVmjZvM_oTpBMdcFguczA.ttf
- Font License: SIL Open Font License, 1.1 (http://scripts.sil.org/OFL)) -->

<!DOCTYPE html>
<html lang="en">
    <%- include('../includes/head.ejs') %>
    <body>
        <%- include('../includes/header.ejs') %>
        <%- include('../includes/menu.ejs') %>
        <%- include('../includes/loading.ejs') %>
            <!-- <div class="main-profile">
                <div class="main-profile__header">
                    <div class="thumbnail">
                        <img src=<%=channel.thumbnail %>>
                    </div>
                    <div class="main-profile__content">
                        <div class="main-profile__content_item">
                            <h1>
                                ì±„ë„ëª… | <%= channel.channelName %>
                            </h1>
                        </div>
                        <div class="main-profile__content_item">
                            <h1>
                                íŒ”ë¡œì›Œ | <%= channel.headcount %>
                            </h1>
                        </div>
                        <div class="main-profile__content_item">
                            <h1>
                                ì±„ë„ëª©ì  | ê°œë°œíŒ€
                            </h1>
                        </div>
                    </div>
                </div>
                <button class="open-modal__btn" id="invite">ìœ ì € ì´ˆëŒ€ í•˜ê¸°</button> -->

                <!-- ìƒìœ„ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ -->
                <div id="div__channel-profile-container">
                    <div class="div__user-list">
                        <div id="thema001">
                            ğŸ‘ğŸ» íŒ€ì› ëª©ë¡
                        </div>
                        <div id="invite" class="user__div-wrapper">
                            <!-- <button class="card" id="invite"><img src="/images/plus-icon.png"></button> -->
                            <img id="add-icon" src="/images/icons8-add-50.png">
                            <div id="invite">
                                <h2>íŒ€ì› ì¶”ê°€</h2>
                            </div>
                        </div>
                        <%if(channel.members.length > 0) { %>
                            <% for(let member of channel.members) { %>
                                <div class="user__div-wrapper">
                                    <img src="<%= member.photo %>">
                                    <div class="card">
                                        <h2><%= member.name %></h2>
                                    </div>
                                </div>
                            <% } %>
                        <% } else { %>
                            <div class="user__div-wrapper">
                                <h2>íŒ€ì›ì„ ì´ˆëŒ€í•˜ì„¸ìš”!!</h2>
                            </div>  
                        <% } %>
                    </div>
                </div>

                <!-- í”„ë¡œí•„ ì˜ì—­ -->
                <div id="div__channel-profile-container">
                    <div id="box-profile">
                        <img src=<%=channel.thumbnail %>>
                        <div id="profile-content">
                            <h3>ì±„ë„ ì •ë³´</h3>
                            <div class="box__div__info">
                                <span> ì±„ë„ ëª… </span><span><h3><%= channel.channelName %></h3></span>
                            </div>
                            <div class="box__div__info">
                                <span> ì°¸ì—¬ ì¸ì› </span><span><h3><%= channel.members.length %> ëª…</h3></span>
                            </div>
                            <div class="box__div__info">
                                <span> ì¹´í…Œê³ ë¦¬ </span><span><h3><%= channel.category %></h3></span>
                            </div>
                        </div>
                        <div id="profile-content">
                            <h3>ì†Œê°œ ê¸€</h3>
                            <p><%= channel.content %></p>
                        </div>
                    </div>
                </div>

                <!-- <div id="div__channel-profile-container">
                    <div class="div__user-list">
                        <div id="box-profile">
                            <div id="profile-content">
                                <h3>ì†Œê°œ ê¸€</h3>
                                <p><%= channel.content %></p>
                            </div>
                        </div>ã„´
                    </div>
                </div>		 -->
                
                <!-- ìœ ì € ì´ˆëŒ€ í´ë¦­ì‹œ ëª¨ë‹¬ì°½ ì˜¤í”ˆ -->
                <div class="invite-container hidden" id="container">
                    <div class="invite-modal hidden" id="modal">
                        <form action="" method="post">
                            <div class="box__input__invite">
                                <h1>ì´ˆëŒ€í•  ì¹œêµ¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.</h1>
                            </div>
                            <div class="box__input__invite">
                                <input type="text" name="clientId" id="clientId" placeholder="ì¹œêµ¬ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.">
                            </div>
                            <div class="box__input__invite">
                                <span><button id="search">ê²€ìƒ‰ í•˜ê¸°</button></span>
                                <span class="close-modal-button__box"><button id="cancel" class="close-modal-channel">ì·¨ì†Œ</button></span>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ê²€ìƒ‰ í›„ ë³´ì¼ ê²°ê³¼ ì°½ -->
                <div class="invite-container hidden" id="searchBox">
                    <div class="invite-modal hidden" id="resultModal">
                        <div id="msg"></div>
                        <form id="form" method="post">
                            <div class="box__input__invite" id="matchedClientId">
                                <!-- í´ë¼ì´ì–¸íŠ¸ ì•„ì´ë”” ë“¤ì–´ê°ˆ ê³³ -->
                            </div>
                            <div class="box__input__invite" id="photo">
                                <!-- ì´ë¯¸ì§€ ë“¤ì–´ê°ˆ ê³³ -->
                            </div>
                            <input type="hidden" name="invitedUserId" id="invitedUserId">
                            <div class="box__input__invite">
                                <span><button type="submit">ì´ˆëŒ€ í•˜ê¸°</button></span>
                            </div>
                        </form>
                        <div class="box__input__invite">
                            <span class="close-modal-button__box"><button id="cancelInvite"
                                    class="close-modal-channel">ì·¨ì†Œ</a></span>
                        </div>
                    </div>
                </div>
                
                <script type="module">
                    import { io } from "https://cdn.socket.io/4.3.2/socket.io.esm.min.js";

                    const socket = io('http://localhost:8080');
                    console.log('ìŠ¤í¬ë¦½íŠ¸ ì†Œì¼“ ê°€ë™ ì¤‘!!!');

                    const reqApi = async () => {
                        try {
                            const clientId = document.getElementById('clientId').value;
                            console.log('clientId: ', clientId);
                            const response = await fetch('http://localhost:8080/v1/user/userInfo/' + clientId, {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });
                            const data = await response.json();
                            console.log('apiì‘ë‹µ data: ', data);

                            //ëª¨ë‹¬ì°½ ì˜¤í”ˆ
                            document.getElementById('searchBox').classList.remove('hidden');
                            document.getElementById('resultModal').classList.remove('hidden');
                            document.getElementById('container').classList.add('hidden');
                            document.getElementById('modal').classList.add('hidden');

                            if (response.status !== 200) {
                                const resultModal = document.getElementById('resultModal');
                                const msg = document.getElementById('msg');

                                console.log(resultModal);
                                msg.style.color = 'red';
                                msg.textContent = data.msg;

                                const form = document.getElementById('form');
                                console.log(form)
                                resultModal.removeChild(form);
                            } else {

                                const msg = document.getElementById('msg');
                                msg.style.color = 'black';
                                msg.textContent = data.msg;

                                console.log(document.getElementById('matchedClientId'));
                                const h1 = document.createElement('h1');
                                h1.textContent = data.user.clientId;
                                document.getElementById('matchedClientId').appendChild(h1);

                                const img = document.createElement('img');
                                img.setAttribute('src', data.user.photo);
                                document.getElementById('photo').appendChild(img);

                                const invitedUserId = document.getElementById('invitedUserId');
                                invitedUserId.setAttribute('value', data.user._id);
                                console.log(invitedUserId);

                                const form = document.getElementById('form');
                                const channelId = document.location.href.split('/')[5];
                                console.log('form: ', form);
                                // ìš”ì²­ ë³´ë‚¼ ë¼ìš°íŠ¸ ì„¸íŒ…
                                form.setAttribute('action', '/client/channel/invite/' + channelId);

                                console.log('í”„ë¡œí•„ ë¡œë”© ì™„ë£Œ!!!');
                            }

                        } catch (err) {
                            if (!err.statusCode) {
                                err.statusCode = 500;
                            }
                        }
                    }

                    document.getElementById('search').addEventListener('click', reqApi);
            </script>
        <%- include('../includes/script.ejs') %>
    </body>
</html>