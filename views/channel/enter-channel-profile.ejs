<!-- This favicon was generated using the following font:

- Font Title: League Spartan
- Font Author: Copyright 2020 The League Spartan Project Authors (https://github.com/theleagueof/league-spartan)
- Font Source: http://fonts.gstatic.com/s/leaguespartan/v11/kJEnBuEW6A0lliaV_m88ja5Twtx8BWhtkDVmjZvM_oTpBMdcFguczA.ttf
- Font License: SIL Open Font License, 1.1 (http://scripts.sil.org/OFL)) -->

<!DOCTYPE html>
<html lang="en">
    <%- include('../includes/head.ejs') %>
    <body>
        <%- include('../includes/header.ejs') %>
        <%- include('../includes/menu.ejs') %>
        <%- include('../includes/loading.ejs') %>
            <!-- <div class="main-profile">
                <div class="main-profile__header">
                    <div class="thumbnail">
                        <img src=<%=channel.thumbnail %>>
                    </div>
                    <div class="main-profile__content">
                        <div class="main-profile__content_item">
                            <h1>
                                Ï±ÑÎÑêÎ™Ö | <%= channel.channelName %>
                            </h1>
                        </div>
                        <div class="main-profile__content_item">
                            <h1>
                                ÌåîÎ°úÏõå | <%= channel.headcount %>
                            </h1>
                        </div>
                        <div class="main-profile__content_item">
                            <h1>
                                Ï±ÑÎÑêÎ™©Ï†Å | Í∞úÎ∞úÌåÄ
                            </h1>
                        </div>
                    </div>
                </div>
                <button class="open-modal__btn" id="invite">Ïú†Ï†Ä Ï¥àÎåÄ ÌïòÍ∏∞</button> -->

                <!-- ÏÉÅÏúÑ Î∂ÄÎ™® Ïª®ÌÖåÏù¥ÎÑà -->
                <div id="div__channel-profile-container">
                    <div class="div__user-list">
                        <div id="thema001">
                            üëçüèª ÌåÄÏõê Î™©Î°ù
                        </div>
                        <div id="invite" class="user__div-wrapper">
                            <!-- <button class="card" id="invite"><img src="/images/plus-icon.png"></button> -->
                            <img id="add-icon" src="/images/icons8-add-50.png">
                            <div id="invite">
                                <h2>ÌåÄÏõê Ï∂îÍ∞Ä</h2>
                            </div>
                        </div>
                        <%if(channel.users.length > 0) { %>
                            <% for(let user of channel.users) { %>
                                <div class="user__div-wrapper">
                                    <img src="<%= user.photo %>">
                                    <div class="card">
                                        <h2><%= user.name %></h2>
                                    </div>
                                </div>
                            <% } %>
                        <% } else { %>
                            <div class="user__div-wrapper">
                                <h2>ÌåÄÏõêÏùÑ Ï¥àÎåÄÌïòÏÑ∏Ïöî!!</h2>
                            </div>  
                        <% } %>
                    </div>
                </div>

                <!-- ÌîÑÎ°úÌïÑ ÏòÅÏó≠ -->
                <div id="div__channel-profile-container">
                    <div class="div__user-list">
                        <div id="box-profile">
                            <img src=<%=channel.thumbnail %>>
                            <div id="profile-content">
                                <h3>Ï±ÑÎÑê Ï†ïÎ≥¥</h3>
                                <div class="box__div__info">
                                    <span> Ï±ÑÎÑê Î™Ö </span><span><h3><%= channel.channelName %></h3></span>
                                </div>
                                <div class="box__div__info">
                                    <span> Ï∞∏Ïó¨ Ïù∏Ïõê </span><span><h3><%= channel.users.length %> Î™Ö</h3></span>
                                </div>
                                <div class="box__div__info">
                                    <span> Ïπ¥ÌÖåÍ≥†Î¶¨ </span><span><h3><%= channel.category %></h3></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="div__channel-profile-container">
                    <div class="div__user-list">
                        <div id="box-profile">
                            <img src=<%=channel.thumbnail %>>
                            <div id="profile-content">
                                <h3>Ï±ÑÎÑê Ï†ïÎ≥¥</h3>
                                <div class="box__div__info">
                                    <span> Ï±ÑÎÑê Î™Ö </span><span><h3><%= channel.channelName %></h3></span>
                                </div>
                                <div class="box__div__info">
                                    <span> Ï±ÑÎÑê Î™Ö </span><span><h3><%= channel.channelName %></h3></span>
                                </div>
                                <div class="box__div__info">
                                    <span> Ï±ÑÎÑê Î™Ö </span><span><h3><%= channel.channelName %></h3></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>		
                
                <!-- Ïú†Ï†Ä Ï¥àÎåÄ ÌÅ¥Î¶≠Ïãú Î™®Îã¨Ï∞Ω Ïò§Ìîà -->
                <div class="invite-container hidden" id="container">
                    <div class="invite-modal hidden" id="modal">
                        <form action="" method="post">
                            <div class="box__input__invite">
                                <h1>Ï¥àÎåÄÌï† ÏπúÍµ¨Î•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî.</h1>
                            </div>
                            <div class="box__input__invite">
                                <input type="text" name="clientId" id="clientId" placeholder="ÏπúÍµ¨ ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.">
                            </div>
                            <div class="box__input__invite">
                                <span><button id="search">Í≤ÄÏÉâ ÌïòÍ∏∞</button></span>
                                <span class="close-modal-button__box"><button id="cancel" class="close-modal-channel">Ï∑®ÏÜå</button></span>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Í≤ÄÏÉâ ÌõÑ Î≥¥Ïùº Í≤∞Í≥º Ï∞Ω -->
                <div class="invite-container hidden" id="searchBox">
                    <div class="invite-modal hidden" id="resultModal">
                        <div id="msg"></div>
                        <form id="form" method="post">
                            <div class="box__input__invite" id="matchedClientId">
                                <!-- ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏïÑÏù¥Îîî Îì§Ïñ¥Í∞à Í≥≥ -->
                            </div>
                            <div class="box__input__invite" id="photo">
                                <!-- Ïù¥ÎØ∏ÏßÄ Îì§Ïñ¥Í∞à Í≥≥ -->
                            </div>
                            <input type="hidden" name="invitedUserId" id="invitedUserId">
                            <div class="box__input__invite">
                                <span><button type="submit">Ï¥àÎåÄ ÌïòÍ∏∞</button></span>
                            </div>
                        </form>
                        <div class="box__input__invite">
                            <span class="close-modal-button__box"><button id="cancelInvite"
                                    class="close-modal-channel">Ï∑®ÏÜå</a></span>
                        </div>
                    </div>
                </div>
                
                <script type="module">
                    import { io } from "https://cdn.socket.io/4.3.2/socket.io.esm.min.js";

                    const socket = io('http://localhost:8080');
                    console.log('Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÜåÏºì Í∞ÄÎèô Ï§ë!!!');

                    const reqApi = async () => {
                        try {
                            const clientId = document.getElementById('clientId').value;
                            console.log('clientId: ', clientId);
                            const response = await fetch('http://localhost:8080/v1/user/userInfo/' + clientId, {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });
                            const data = await response.json();
                            console.log('apiÏùëÎãµ data: ', data);

                            //Î™®Îã¨Ï∞Ω Ïò§Ìîà
                            document.getElementById('searchBox').classList.remove('hidden');
                            document.getElementById('resultModal').classList.remove('hidden');
                            document.getElementById('container').classList.add('hidden');
                            document.getElementById('modal').classList.add('hidden');

                            if (response.status !== 200) {
                                const resultModal = document.getElementById('resultModal');
                                const msg = document.getElementById('msg');

                                console.log(resultModal);
                                msg.style.color = 'red';
                                msg.textContent = data.msg;

                                const form = document.getElementById('form');
                                console.log(form)
                                resultModal.removeChild(form);
                            } else {

                                const msg = document.getElementById('msg');
                                msg.style.color = 'black';
                                msg.textContent = data.msg;

                                console.log(document.getElementById('matchedClientId'));
                                const h1 = document.createElement('h1');
                                h1.textContent = data.user.clientId;
                                document.getElementById('matchedClientId').appendChild(h1);

                                const img = document.createElement('img');
                                img.setAttribute('src', data.user.photo);
                                document.getElementById('photo').appendChild(img);

                                const invitedUserId = document.getElementById('invitedUserId');
                                invitedUserId.setAttribute('value', data.user._id);
                                console.log(invitedUserId);

                                const form = document.getElementById('form');
                                const channelId = document.location.href.split('/')[5];
                                console.log('form: ', form);
                                // ÏöîÏ≤≠ Î≥¥ÎÇº ÎùºÏö∞Ìä∏ ÏÑ∏ÌåÖ
                                form.setAttribute('action', '/client/channel/invite/' + channelId);

                                console.log('ÌîÑÎ°úÌïÑ Î°úÎî© ÏôÑÎ£å!!!');
                            }

                        } catch (err) {
                            if (!err.statusCode) {
                                err.statusCode = 500;
                            }
                        }
                    }

                    document.getElementById('search').addEventListener('click', reqApi);
            </script>
        <%- include('../includes/script.ejs') %>
    </body>
</html>